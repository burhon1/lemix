{% extends 'atomic/theme.html' %}
{% load static %}
{% load custom_tags %}
{% load user_tags %}
{% block title %}
Lidlar Ro'yxati- Lemix
{% endblock %}

{% block style %}
<style>
    .error
    {
    color: red;
    }
    .msg
    {
    display:none;
    }
    .cardPay {
        position: relative;
    }

    .cardPay:hover {
        border: 1px solid #5f63f2;

    }

    .cardPay:hover::after {
        content: "";
        position: absolute;
        left: 0;
        right: 0;
        bottom: 0;
        top: 0;
        border-radius: 5px;
        height: 100%;
        width: 100%;
        background-color: #5f63f288;
    }

    .feature-card--1 figcaption h5 {
        margin: 0 0 0.5rem 0 !important;
    }

    .feature-cards:hover {
        cursor: pointer;
        box-shadow: 0 0 5px #5f63f2;
    }

    .atbd-tab .tab-content p {
        font-size: 12px !important;
    }

    .v-num {
        font-size: 14px;
    }

    .application-faqs .panel-title a {
        font-size: 12px !important;
    }

    .forms-view {
        display: flex;
        flex-wrap: wrap;
    }

    .forms-view>.form-group {
        display: flex;
        align-items: center;
    }

    .table-responsive tr td>div {
        text-transform: none;
    }

    .atbd-select .select2-selection,
    .select2-container--default .select2-selection--single {
        height: 1.875rem;
        padding: 0;
        font-size: 12px;
        line-height: 1.5;
        -webkit-border-radius: 0.2rem;
        border-radius: 0.2rem;
        margin-right: 7px;
    }
</style>
{% endblock %}

{% block content %}
        
<div class="atbd-page-content">

    <div class="container-fluid">
        <div class="mt-3">
            <div class="row">
                <div class="col-lg-12">
                    <div class="breadcrumb-main d-flex justify-content-between mt-4 align-items-center">
                        <h4 class=" breadcrumb-title" >Lidlar - {{objs.count}}ta</h4>
                        <div class="breadcrumb-action justify-content-center flex-wrap">
                            <div class="has-subMenu-left  d-flex ">
                                <button class="btn btn-primary btn-xs ml-3 drawer-trigger" data-drawer="profile"
                                onclick="checkedLeads()"> <span data-feather="mail"></span> SMS jo'natish</button>
                                <button class="btn btn-primary btn-xs ml-3 drawer-trigger"
                                    data-drawer="account">+ Lid qo'shish</button>
                                <!-- <button class=" btn btn-primary btn-xs ml-3">Vazifalar</button> -->
                                <a href="{% url 'admintion:forms' %}"
                                    class=" btn btn-primary btn-xs ml-3"> <span data-feather="file-text"></span>Formalar</a>
                                <a href="{% url 'admintion:lead-archive-list' %}"
                                    class=" btn btn-primary btn-xs ml-3"> <span data-feather="archive"></span>Arxiv</a>
                                </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-12 mb-30">
                <div class="card">
                    <div class="card-body">
                        <div class="userDatatable global-shadow border-0 bg-white w-100">
                            <form class="filter-form mb-4">
                                <div class="row">
                                    <div class="col-3">
                                        <input class="form-control mr-sm-2 box-shadow-none" type="text" placeholder="Search...">
                                    </div>
                                    <div class="col-2">
                                        <div class="atbd-select">
                                            <select name="select-courses" id="select-courses" class="form-control" name="source__id" onchange="dropdownChanged(event,'source__id')">
                                                <option value="0" selected>Manba</option>
                                                {% for source in sources %}
                                                <option value="{{source.id}}">{{source.title}}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-2">
                                        <div class="atbd-select ">
                                            <select name="select-groups" id="select-groups" class="form-control" name="status__id" onchange="dropdownChanged(event,'status__id')">
                                                <option value="0" selected>Holati</option>
                                                {% for lead_status in lead_statuses %}
                                                <option value="{{lead_status.id}}">{{lead_status.status}}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-2">
                                        <div class="atbd-select ">
                                            <select name="select-teacher" id="select-teacher" class="form-control" name="author__id" onchange="dropdownChanged(event,'author__id')">
                                                <option value="0" selected>Xodimlar</option>
                                                {% for task_responsible in task_responsibles %}
                                                <option value="{{task_responsible.id}}">{{task_responsible.title}}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-3">
                                        <div class="atbd-date-ranger position-relative m-0 d-flex align-items-center">
                                            <div class="form-group mb-0">
                                                <input type="text" name="date-range-from" class="form-control form-control-default" id="date-from-4" placeholder="Start" name="created_at__gte" onchange="dropdownChanged(event,'created_at__gte');alert(5)">
                                            </div>
                                            <span class="divider">-</span>
                                            <div class="form-group mb-0">
                                                <input type="text" name="date-range-to" class="form-control form-control-default" id="date-to-4" placeholder="End" name="created_at__lte" onchange="dropdownChanged(event,'created_at__lte')">
                                            </div>
                                            <a class="date-picker-icon" href="#"><span data-feather="calendar"></span></a>
                                        </div>
                                    </div>
                                </div>
                            </form>
                            <div class="table-responsive">
                                <table class="table mb-0 table-borderless">
                                    <thead>
                                        <tr class="userDatatable-header">
                                            <th>
                                                <div class="d-flex align-items-center">
                                                    <div class="custom-checkbox  check-all">
                                                        <input class="checkbox" type="checkbox"
                                                            id="check-3">
                                                        <label for="check-3">
                                                            <span
                                                                class="checkbox-text userDatatable-title">FIO
                                                                & Telefon</span>
                                                        </label>
                                                    </div>
                                                </div>
                                            </th>
                                            <th>
                                                <span class="userDatatable-title">Manbasi</span>
                                            </th>
                                            <th>
                                                <span class="userDatatable-title">Holati</span>
                                            </th>

                                            <th>
                                                <span class="userDatatable-title">Izoh</span>
                                            </th>
                                            <th>
                                                <span class="userDatatable-title">Xodim & Sanasi</span>
                                            </th>
                                            <th>
                                                <span class="userDatatable-title float-right"><svg
                                                        xmlns="http://www.w3.org/2000/svg" width="24"
                                                        height="24" viewBox="0 0 24 24" fill="none"
                                                        stroke="currentColor" stroke-width="2"
                                                        stroke-linecap="round" stroke-linejoin="round"
                                                        class="feather feather-more-horizontal">
                                                        <circle cx="12" cy="12" r="1" />
                                                        <circle cx="19" cy="12" r="1" />
                                                        <circle cx="5" cy="12" r="1" />
                                                    </svg></span>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for lead in objs %}
                                        <tr>
                                            <td>
                                                <div class="d-flex">
                                                    <div
                                                        class="userDatatable__imgWrapper d-flex align-items-center">
                                                        <div class="checkbox-group-wrapper">
                                                            <div class="checkbox-group d-flex">
                                                                <div
                                                                    class="checkbox-theme-default custom-checkbox checkbox-group__single d-flex">
                                                                    <input class="checkbox leadCheckBox"
                                                                        type="checkbox"
                                                                        id="check-grp-{{lead.id}}">
                                                                    <label
                                                                        for="check-grp-{{lead.id}}"></label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- <a href="#" class="profile-image rounded-circle d-block m-0 wh-38" style="background-image:url('img/tm6.png'); background-size: cover;"></a> -->
                                                    </div>
                                                    <div class="userDatatable-inline-title">
                                                        <a href="{% url 'admintion:lead-detail' lead.id %}"
                                                            class="text-dark fw-500">
                                                            <h6>{{ lead.full_name }}</h6>
                                                        </a>
                                                        <p class="d-block mb-0">
                                                            {{ lead.phone_number }}
                                                        </p>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>
                                                <div class="userDatatable-content">
                                                    {{ lead.source__title}}
                                                </div>
                                            </td>
                                            <td>
                                                <div class="userDatatable-content d-inline-block">
                                                    <span class="bg-opacity-{{status__color}}  color-{{status__color}} rounded-pill userDatatable-content-status active">{{lead.status__status|default:'' }}</span>
                                                </div>

                                            </td>

                                            <td>
                                                <div class="userDatatable-content">
                                                    {{ lead.comment }}
                                                </div>
                                            </td>
                                            <td>
                                                <div class="d-flex">
                                                    <div class="userDatatable-inline-title">
                                                        <a href="#" class="text-dark fw-500">
                                                            <h6>
                                                                {% if lead.via_form__title %}
                                                                <small>
                                                                    <span class="bg-opacity-primary  color-primary b-2 userDatatable-content-status active">
                                                                        Havola orqali
                                                                    </span>
                                                                </small>
                                                                {% else %}
                                                                {{lead.author_name}}
                                                                {% endif %}
                                                            </h6>
                                                        </a>
                                                        <p class="d-block mb-0">
                                                            {{ lead.created_at|date:'d/m/Y -H:i' }}
                                                        </p>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>
                                                <ul class="orderDatatable_actions mb-0 d-flex flex-wrap">

                                                    <li>
                                                        <a href="#" class="view drawer-trigger" data-drawer="profile">
                                                            <span data-feather="mail"></span></a>
                                                    </li>
                                                    <li>
                                                        <a href="#" class="edit" data-toggle="modal" data-target="#modal-phone">
                                                            <span data-feather="phone"></span></a>
                                                    </li>
                                                    <!-- <li>
                                                                <a href="#" class="view"  data-toggle="modal" data-target="#modal-basic1">
                                                                    <span data-feather="rotate-ccw"></span></a>
                                                            </li> -->
                                                    <!-- <li>
                                                                <a href="#" class="edit">
                                                                    <span data-feather="edit"></span></a>
                                                            </li> -->
                                                    <li>
                                                        <a href="#" class="remove"
                                                            onclick="changeModal('{{lead.id}}')"
                                                            data-toggle="modal" data-target="#modal-basic">
                                                            <span data-feather="trash-2"></span></a>
                                                    </li>
                                                </ul>
                                            </td>
                                        </tr>
                                        {% empty %}

                                        {% endfor %}

                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- <div class="d-flex justify-content-sm-end justify-content-start pt-25">
                            <nav class="atbd-page ">
                                <ul class="atbd-pagination d-flex">
                                    <li class="atbd-pagination__item">
                                        <a href="#" class="atbd-pagination__link pagination-control"><span class="la la-angle-left"></span></a>
                                        <a href="#" class="atbd-pagination__link"><span class="page-number">1</span></a>
                                        <a href="#" class="atbd-pagination__link active"><span class="page-number">2</span></a>
                                        <a href="#" class="atbd-pagination__link"><span class="page-number">3</span></a>
                                        <a href="#" class="atbd-pagination__link pagination-control"><span class="page-number">...</span></a>
                                        <a href="#" class="atbd-pagination__link"><span class="page-number">12</span></a>
                                        <a href="#" class="atbd-pagination__link pagination-control"><span class="la la-angle-right"></span></a>
                                        <a href="#" class="atbd-pagination__option">
                                        </a>
                                    </li>
                                    <li class="atbd-pagination__item">
                                        <div class="paging-option">
                                            <select name="page-number" class="page-selection">
                                                <option value="20">20/page</option>
                                                <option value="40">40/page</option>
                                                <option value="60">60/page</option>
                                            </select>
                                        </div>
                                    </li>
                                </ul>
                            </nav>
                        </div> -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-basic modal" id="modal-basic1" tabindex="-1" role="dialog" aria-hidden="true">


        <div class="modal-dialog modal-md" role="document">
            <div class="modal-content modal-bg-white ">
                <div class="modal-header">



                    <h6 class="modal-title">Lidni aktivlashtirish.</h6>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span data-feather="x"></span></button>
                </div>
                <div class="modal-body">
                    <p>Ushbu lid avtiv lidlar qatoriga kiritilsinmi?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary btn-sm" id="activateBtn">Ha</button>
                    <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">Yoq</button>
                </div>
            </div>
        </div>


    </div>
    <div class="modal-basic modal" id="modal-basic2" tabindex="-1" role="dialog" aria-hidden="true">


        <div class="modal-dialog modal-md" role="document">
            <div class="modal-content modal-bg-white ">
                <div class="modal-header">
                    <h6 class="modal-title">Sms matni.</h6>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span data-feather="x"></span></button>
                </div>
                <div class="modal-body">
                    <div class="sms-status-message"></div>
                    <form action="#">
                        <div class="form-row">
                            <div class="form-group col-lg-12">
                                <label for="id_message">Xabar matni</label>
                                <textarea type="text" name="id_message" id="id_message"
                                    class="form-control form-control-sm border-light"
                                    placeholder="Xabar matni..."></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary btn-sm" id="sendSMS">Jo'natish</button>
                    <button type="button" class="btn btn-secondary btn-sm" id="cancelSMS"
                        data-dismiss="modal">Bekor qilish</button>
                </div>
            </div>
        </div>


    </div>
    <div class="modal-basic modal" id="modal-phone" tabindex="-1" role="dialog"
            aria-hidden="true">
            <div class="modal-dialog modal-md" role="document">
                <div class="modal-content modal-bg-white ">
                    <div class="modal-header">
                        <h6 class="modal-title">Telefon qilish</h6>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span data-feather="x"></span></button>
                    </div>
                    <div class="modal-body">
                        <p>IP telefoniya(virtual raqam) xizmati sizning tarifingizda ulanmagan. Ushbu
                            xizmatni ulash yoki batafsil ma'lumot olish uchun qo'llab-quvvatlash markaziga
                            murojaat qiling. </p>
                    </div>
                    <div class="modal-footer">
                        <!-- <button type="button" class="btn btn-primary btn-sm">Ha</button> -->
                        <button type="button" class="btn btn-primary btn-sm"
                            data-dismiss="modal">Rahmat</button>
                    </div>
                </div>
            </div>


        </div>
    <div class="drawer-basic-wrap">
        <div class="atbd-drawer drawer-account d-none" style="overflow: scroll;">
            <div class="atbd-drawer__header d-flex aling-items-center justify-content-between">
                <h6 class="drawer-title">Yangi lid qo’shish</h6>
                <a href="#" class="btdrawer-close"><i class="la la-times"></i></a>
            </div><!-- ends: .atbd-drawer__header -->
            <div class="atbd-drawer__body">
                <div class="drawer-content">
                    <div class="drawer-account-form form-basic">
                        <form action="{% url 'admintion:lead-list' %}" method="post" id="form">
                            {% csrf_token %}
                            <div class="form-row">
                                <div class="form-group col-lg-6">
                                    <label for="fio"><b class="text-danger">*</b>Ism</label>
                                    <input type="text" name="fio" id="fio"
                                        class="form-control form-control-sm border-light"
                                        placeholder="Isminggiz...">
                                </div>
                                <div class="form-group col-lg-6">
                                    <label for="tel"><b class="text-danger">*</b>Telefon raqam</label>
                                    <input name="phone" id="phone"
                                        class="form-control form-control-sm border-light"
                                        placeholder="** ***_**_**" type="text"  maxlength="9">
                                </div>
                                <div class="form-group col-lg-6">
                                    <label for="manba"><b class="text-danger">*</b>Manbasi</label>
                                    <select name="manba" id="manba" class="form-control-sm border-light" required>
                                        <option value="0">-----------</option>
                                        {% for source in sources %}
                                        <option value="{{source.id}}">{{ source.title }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="form-group col-lg-6">
                                    <label for="hol"><b class="text-danger">*</b>Holati</label>
                                    <select name="hol" id="hol" class="form-control-sm border-light" required>
                                        <option value="0">-----------</option>
                                        {% for status in lead_statuses %}
                                        <option value="{{status.id}}">{{ status.status }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="form-group col-12">
                                    <label for="description">Izoh</label>
                                    <textarea name="description" id="description"
                                        class="form-control border-light form-control-sm"
                                        placeholder="Izoh"></textarea>
                                </div>
                                <div class="col-12 view-form form-row">
                                </div>
                                <div class="col-12">
                                    <div class="buttons d-flex flex-wrap  w-100">
                                        <button type="button"
                                            class="btn btn-icon btn-circle btn-outline-primary mr-3 btn-parents">
                                            <span data-feather="users"></span>
                                            <!-- <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                stroke-width="2" stroke-linecap="round"
                                                stroke-linejoin="round" class="feather feather-users">
                                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                                                <circle cx="9" cy="7" r="4" />
                                                <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
                                                <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                                            </svg> -->
                                        </button>
                                        <button type="button"
                                            class="btn btn-icon btn-circle btn-outline-primary mr-3 btn-telegram">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                stroke-width="2" stroke-linecap="round"
                                                stroke-linejoin="round" class="feather feather-send">
                                                <line x1="22" y1="2" x2="11" y2="13" />
                                                <polygon points="22 2 15 22 11 13 2 9 22 2" />
                                            </svg>
                                        </button>
                                        <button type="button"
                                            class="btn btn-icon btn-circle btn-outline-primary mr-3 btn-location">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                stroke-width="2" stroke-linecap="round"
                                                stroke-linejoin="round" class="feather feather-map-pin">
                                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" />
                                                <circle cx="12" cy="10" r="3" />
                                            </svg>
                                        </button>
                                        <button type="button"
                                            class="btn btn-icon btn-circle btn-outline-primary  mr-3 btn-email">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                stroke-width="2" stroke-linecap="round"
                                                stroke-linejoin="round" class="feather feather-mail">
                                                <path
                                                    d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" />
                                                <polyline points="22,6 12,13 2,6" />
                                            </svg>
                                        </button>
                                        <button type="button"
                                            class="btn btn-icon btn-circle btn-outline-primary  mr-3 btn-pasport">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                stroke-width="2" stroke-linecap="round"
                                                stroke-linejoin="round" class="feather feather-file-text">
                                                <path
                                                    d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                                                <polyline points="14 2 14 8 20 8" />
                                                <line x1="16" y1="13" x2="8" y2="13" />
                                                <line x1="16" y1="17" x2="8" y2="17" />
                                                <polyline points="10 9 9 9 8 9" />
                                            </svg>
                                        </button>
                                        <button type="button"
                                            class="btn btn-icon btn-circle btn-outline-primary  mr-3 btn-file">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                stroke-width="2" stroke-linecap="round"
                                                stroke-linejoin="round"
                                                class="feather feather-upload-cloud">
                                                <polyline points="16 16 12 12 8 16" />
                                                <line x1="12" y1="12" x2="12" y2="21" />
                                                <path
                                                    d="M20.39 18.39A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.3" />
                                                <polyline points="16 16 12 12 8 16" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                <a href="#" class="text-right d-block col-12"
                                    onclick="handleAddGroup()">+Guruhga
                                    qo'shish: </a>
                                <div class="group_add"></div>
                                <a href="#" class="text-right d-block col-12"
                                    onclick="handleAddTask()">+Topshiriq
                                    qo’shish: </a>
                                <div class="task_add"></div>
                            </div>
                            <button type="submit"  class="btn btn-primary">Saqlash</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="atbd-drawer drawer-profile d-none">
            <div class="atbd-drawer__header d-flex aling-items-center justify-content-between">
                <h6 class="drawer-title">SMS yuborish</h6>
                <a href="#" class="btdrawer-close"><i class="la la-times"></i></a>
            </div><!-- ends: .atbd-drawer__header -->
            <div class="atbd-drawer__body">
                <div class="drawer-content">
                    <div class="drawer-account-form form-basic">
                        <form action="#">
                            <div class="form-row">

                                <div class="form-group col-12">
                                    <label for="description">Xabar matni</label>
                                    <textarea name="description" id="description"
                                        class="form-control form-control-sm"
                                        placeholder="Xabar matnini kiriting..."></textarea>
                                </div>

                                <div class="form-group col-12">
                                    <small id="small_code"></small>
                                </div>
                                <div class="form-group col-12">
                                    <a href="./sms_yoriqnoma.html">SMSda simvollarni ishlatish bo'yicha
                                        yo'riqnoma</a>
                                </div>
                                <div class="form-group col-12">
                                    <div class="btn btn-primary">Yuborish</div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div><!-- ends: .atbd-drawer__body -->
        </div>
        <div class="overlay-dark"></div>
        <div class="overlay-dark-l2"></div>
    </div>

    <div class="modal-basic modal" id="modal-basic" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-md" role="document">
            <div class="modal-content modal-bg-white ">
                <div class="modal-header">
                    <h6 class="modal-title">Lidni o'chirish</h6>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span data-feather="x"></span></button>
                </div>
                <div class="modal-body">
                    <p>Ushbu arxivdagi lidni haqiqatdan ham o'chirmoqchimisiz?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary btn-sm" id="deleteBtn">Ha,
                        o'chirilsin</button>
                    <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">Bekor
                        qilish</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-basic modal" id="modal-basic1" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-md" role="document">
            <div class="modal-content modal-bg-white ">
                <div class="modal-header">
                    <h6 class="modal-title">Lidni avtivlashtirish.</h6>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span data-feather="x"></span></button>
                </div>
                <div class="modal-body">
                    <p>Ushbu lid avtiv lidlar qatoriga kiritilsinmi?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary btn-sm">Ha</button>
                    <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">Yoq</button>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- ends: .atbd-page-content -->

    {% endblock %}
    {% block script %}
    <script>
        function changeLeadStatus(id,) {
            var url = `/admintion/leads/${id}/archive/`;
            fetch(url, {
                method: 'get',
                headers: {
                    'Accept': 'application/json',
                },
            })
                .then(res => {
                    window.location.reload()
                })
                .catch(err => {
                    console.log(err);
                })
        }


        function changeModal(id) {
            btn = document.getElementById('deleteBtn');
            btn.setAttribute('onclick', `changeLeadStatus('${id}')`)
            console.log(btn);
        }

        var formName = document.querySelector(".form-name");
        var formPhone = document.querySelector(".form-phone");
        var formDate = document.querySelector(".form-birthdate");
        var formGender = document.querySelector(".form-gender");

        function validation(element,action){
            element.addEventListener(action,(evt)=>{
            if(evt.target.value){
                evt.target.className = "is-valid form-control ih-medium ip-light radius-xs b-light form-name";
            } else{
                evt.target.className = "is-invalid form-control ih-medium ip-light radius-xs b-light form-name";
            }
        })
        }
        if(formDate){
            validation(formName,"input")
        }
     
        
        var form = document.querySelector('.view-form');
        function handleAddItem(_id, names, labelName, typs, plcs, btn, isActive) {
            var doc_id = document.querySelector('#' + _id)
            if (!doc_id) {
                var wrap = document.createElement('div');
                wrap.classList.add(...['form-group', 'row', 'w-100', 'mx-0']);
                wrap.id = _id;
                var label = document.createElement('label');
                label.for = "a" + names[0];
                label.classList.add(...['il-gray', 'fs-14', 'fw-500', 'align-center', 'col-md-12']);
                label.textContent = labelName;
                wrap.appendChild(label);
                typs.map((item, index) => {
                    var input = document.createElement('input');
                    input.type = item;
                    input.classList.add(...['col-md-' + Math.floor(10 / typs.length), 'form-control', 'ih-medium', 'ip-light', 'radius-xs', 'b-light', 'px-15', 'mx-2']);
                    input.id = "a" + names[index];
                    input.name = `${_id.split("-")[0]}_${names[index]}`;
                    input.placeholder = plcs[index];
                    wrap.appendChild(input);
                    input = null;
                })
                var img = document.createElement('p');
                img.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>`
                // var img = document.createElement('img');
                // img.src = "{% static 'img/svg/ixis.svg' %}";
                img.className = "ml-auto";
                img.addEventListener('click', function () {
                    document.querySelector('#' + _id).remove()
                    isActive = false
                    console.log(isActive)
                    btn.className = "btn btn-icon btn-circle btn-outline-primary mr-3"
                })
                wrap.appendChild(img);
                form.appendChild(wrap);
                label = null;
            }
            else {
                doc_id.remove()
            }
        }
        
        var  parentsBtn = document.querySelector(".btn-parents")
        var  telegramBtn = document.querySelector(".btn-telegram")
        var  locationBtn = document.querySelector(".btn-location")
        var  emailBtn = document.querySelector(".btn-email")
        var  pasportBtn = document.querySelector(".btn-pasport")
        var  fileBtn = document.querySelector(".btn-file")
    
        function setActiveBtn(btn, ...props){
            var isActive = false;
            btn.addEventListener("click",(evt)=>{
            if(isActive){
                isActive = false;
                btn.className = "btn btn-icon btn-circle btn-outline-primary mr-3"
            } else{
                isActive=true;
                btn.className = "btn btn-icon btn-circle btn-primary mr-3"
            }
            handleAddItem(...props, btn, isActive)
        })
        }
        
        setActiveBtn(parentsBtn, 'parent-23',['name','phone'],'Ota-ona',['text','text'],['Ota-ona...','(99) 134-56-87'])
        setActiveBtn(telegramBtn, 'telegram-23',['telegram'],'Telegram',['text'],['(99) 134-56-87'])
        setActiveBtn(locationBtn, 'location-23',['location'],'Manzil',['text'],['Manzil...'])
        setActiveBtn(emailBtn, 'email-23',['location'],'Email',['email'],['Email...'])
        setActiveBtn(pasportBtn, 'password-23',['password'],'Passport',['text'],['AA0000000'])
        setActiveBtn(fileBtn, 'file-23',['file'],'Fayl Yuklash',['file'],['AA0000000'])

        

        var cancelBtn = document.getElementById('cancelSMS');
        cancelBtn.addEventListener('click', ()=>{
            var input = document.getElementById('id_message');
            input.value = '';
        })
    
        var sendSMS = document.getElementById('sendSMS');
        sendSMS.addEventListener('click', ()=>{
            var formData = new FormData();
            formData.append('csrfmiddlewaretoken', '{{ csrf_token }}')
            var input = document.getElementById('id_message');
            formData.append('message', input.value);
            var checkboxes = document.getElementsByClassName('studentCheckbox');
            for(var i=0;i<checkboxes.length;i++){
                if(checkboxes[i].checked == true){
                    formData.append('students', checkboxes[i].id.split('-')[2]);
                }
            }
            var url = `{% url 'admintion:send_sms_to_student' %}`
            fetch(url, {
                method:'post',
                headers:{
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: formData,
            })
            .then(res=>{
                
                if(res.status==200){
                    alert("Xabar O'quvchilarga yuborildi.");
                    var input = document.getElementById('id_message');
                    input.value = '';
                } else {
                    alert('sda')
                } 
            })
        })
    
        function checkedStudents(){
            var checkboxes = document.getElementsByClassName('studentCheckbox');
            var leads = []
            for(var i=0;i<checkboxes.length;i++){
                if(checkboxes[i].checked == true) {
                    leads.push(checkboxes[i].id.split('-')[2]);
                }
            }
            var formData = new FormData();
            formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');
            for(var i=0;i< leads.length;i++){
                formData.append('students', leads[i]);
            }
            // var url = "{% url 'admintion:check-sms-availability' %}";
            fetch("{% url 'admintion:check-sms-availability' %}", {
                method:'post',
                headers:{
                    'Accept':'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: formData
            })
            .then(res=>res.json())
            .then(res=>{
                var div = document.getElementsByClassName('sms-status-message')[0];
                //div.classList.add('d-flex m-2 p-2')
                div.innerHTML = `<p class="mb-3">Sms yuboriladigan foydalanuvchilar soni: ${res.users}<br>
                                 Sizda jami ${res.sms_limit} ta miqdorida bonus sifatidagi smslar mavjud. Bu limit tugagach,
                                sizdan sms integratsiya qilingan email va parol so'raladi.  </p>             
                `
            })
            .catch(err=>{
                console.log(err);
            })
        }
    
        function handleStudentDelete(id){
            var tr = document.querySelector(`#student-${id}`);
            fetch(`/admintion/student/${id}/delete/`, {
                method:'post',
                headers:{
                    'Accept':'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                }
            })
            .then(res=>res.json())
            .then(res=>{
               if(res.status==302){
                tr.remove();
               }
            })
            .catch(err=>{
                
            })
        }
        
        function handleAddGroup(){
            var group_add = document.querySelector('.group_add');
            group_add.className='row w-100 group_add d-flex';
            var group_list = {{groups|safe}};
            if(group_add.innerHTML){
                group_add.innerHTML="";
                return;
            }
    
            
            ["Guruh","Vaqti"].map((item)=>{
                if(item === "Vaqti"){
                    var wrap = document.createElement('div');
                    wrap.className='form-group col-md-6';
                    var calendar = `
                    <div class="atbd-date-picker">
                                        <div class="form-group mb-0 form-group-calender">
                                            <div class="position-relative">
                                                <label for="datepickre2">${item}</label>
                                                <input type="date" name="group_date" class="form-control form-control-default hasDatepicker" id="datepicker4" placeholder="January 20, 2018">
                                            </div>
                                        </div>
                                    </div>
                    `
                    wrap.innerHTML = calendar;
                    group_add.appendChild(wrap)
                } else{
                var wrap = document.createElement('div');
                wrap.className='form-group col-md-6';
                var select = document.createElement('select');
                var label = document.createElement('label');
                select.name="group";

                group_list.map((item)=>{
                    var option = document.createElement('option');
                    option.value = item.id;
                    option.textContent = item.title;
                    select.appendChild(option);
               })
               label.textContent=item;
               label.className='il-gray fs-14 fw-500 align-center';
               select.className='form-control px-15';
               wrap.appendChild(label);
               wrap.appendChild(select)
               group_add.appendChild(wrap)
                }
                
            })
               
        }

        function handleAddTask(){
            var task_add = document.querySelector('.task_add');
            task_add.className='row w-100 task_add d-flex';
            if(task_add.innerHTML){
                task_add.innerHTML="";
                return;
            }

            ["Ma'sul","Topshiriq mavzusi","Vaqti","Topshiriq matni"].map((item)=>{
                if(item === "Vaqti"){
                    var wrap = document.createElement('div');
                    wrap.className='form-group col-md-12';
                    var calendar = `
                        <div class="atbd-date-picker">
                            <div class="form-group mb-0 form-group-calender">
                                <div class="position-relative">
                                    <label for="datepickre2">${item}</label>
                                    <input type="date" class="form-control form-control-default" id="datepicker2" placeholder="January 20, 2018" name="task_date">
                                    <a href="#"><span data-feather="calendar"></span></a>
                                </div>
                            </div>
                        </div>
                    `
                    wrap.innerHTML = calendar;
                    task_add.appendChild(wrap)
                } else if(item === "Topshiriq matni") {
                    console.log(item)
                    var wrap = document.createElement('div');
                    wrap.className='form-group col-md-12';
                    var textarea = `
                            <label for="task-comment"
                                class="il-gray fs-14 fw-500 align-center">${item}</label>
                            <textarea name="task_comment" class="form-control" id="task-comment"
                                rows="3"></textarea>
                    `;
                    wrap.innerHTML= textarea;
                    task_add.appendChild(wrap)
                }
                else{
                var wrap = document.createElement('div');
                wrap.className='form-group col-md-6';
                var select = document.createElement('select');
                var label = document.createElement('label');
                select.name=item;
                var vals_options=[];
                if(item == "Ma'sul"){
                    select.name="task_who"
                    vals_options = {{task_responsibles|safe}};
                }
                else {
                    select.name="task_type"
                    vals_options = {{task_types|safe}};
                }

                vals_options.map((item)=>{
                    var option = document.createElement('option');
                    option.value = item.id;
                    option.textContent = item.title;
                    select.appendChild(option);
               })
               label.textContent=item;
               label.className='il-gray fs-14 fw-500 align-center';
               select.className='form-control px-15';
               wrap.appendChild(label);
               wrap.appendChild(select)
               task_add.appendChild(wrap)
                }
                
            })
               
        }


    </script>
    <script type="text/javascript">
        var url_path = '/admintion/leads/filter?';
        var detailUrl="/admintion/groups/<int:id>/detail/"
        var params = {
            source__id:'',
            status__id:'',
            author__id:'',
            created_at__gte:'',
            created_at__lte:''
        }
        function generate_path(){
            parms = new URLSearchParams(params);
            return url_path+parms
        }
        //students list 
        function request_form(url,headers,func){
            return fetch(url, headers)
            .then(res=>res.json())
            .then(res=>{
                if(res.status==200){
                    func(res.data)
                } else {
                    alert("Ma'lumotlar to'liq kiritilmadi");;
                } 
            }).catch(err=>{  
            })
        }
        function get_request(url,func){
            return (
                request_form(url,{
                method:'get',
                headers:{
                    'X-CSRFToken': '{{ csrf_token }}'
                },
            },func)
            )
        }
    
        function createCheckbox(dflex,student_id,idx){
            var wrapimg = document.createElement('div');
            wrapimg.className='userDatatable__imgWrapper d-flex align-items-center';
            var checkboxWrap = document.createElement('div');                                 
            checkboxWrap.className='checkbox-group-wrapper';
            var checkboxGroup = document.createElement('div');
            checkboxGroup.className='checkbox-group d-flex';
            var checkboxTheme = document.createElement('div');
            checkboxTheme.className='checkbox-theme-default custom-checkbox checkbox-group__single d-flex';
            var checkInput = document.createElement('input');
            checkInput.className='checkbox studentCheckbox';
            checkInput.type='checkbox';
            checkInput.id=`check-grp-${student_id}`;
            var label = document.createElement('label');
            label.for = `check-grp-${student_id}`
            var span = document.createElement('span');
            span.className='checkbox-text userDatatable-title';
            span.textContent=`#${++idx}`;
            label.appendChild(span);
            checkboxTheme.appendChild(checkInput)
            checkboxTheme.appendChild(label)
            checkboxGroup.appendChild(checkboxTheme)
            checkboxWrap.appendChild(checkboxGroup);
            wrapimg.appendChild(checkboxWrap);
            return wrapimg;
        }
    
        function createAction(detailU,_id,title){
            var ul = document.createElement('ul');
            ul.className="orderDatatable_actions mb-0 d-flex flex-wrap";
            var li = document.createElement('li');
            var a = document.createElement('a');
            a.className='view';
            a.href=detailU
            a.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-eye"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>`
            li.appendChild(a);
            ul.appendChild(li);
            var a = document.createElement('a');
            var li = document.createElement('li');
            a.className='edit';
            a.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>`
            li.appendChild(a);
            ul.appendChild(li);
            var a = document.createElement('a');
            var li = document.createElement('li');
            a.className='remove';
            a.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>`
            a.addEventListener('click',()=>setDelModal(_id,title))
            li.appendChild(a);
            ul.appendChild(li);
            return ul;
        }
    
        function dataList(datas){
            var tbody = document.querySelector('tbody');
    
            while(tbody.firstChild) {
                tbody.removeChild(tbody.firstChild);
                }
            datas.forEach((element,idx) => {
                var tr = document.createElement('tr');
                tr.id = `student-${element.student_ids}`
                tr.innerHTML = `
                                            <td>
                                                <div class="d-flex">
                                                    <div class="userDatatable__imgWrapper d-flex align-items-center">
                                                        <div class="checkbox-group-wrapper">
                                                            <div class="checkbox-group d-flex">
                                                                <div class="checkbox-theme-default custom-checkbox checkbox-group__single d-flex">
                                                                    <input class="checkbox leadCheckBox" type="checkbox" id="check-grp-${element.student_ids}">
                                                                    <label for="check-grp-${element.student_ids}"></label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="userDatatable-inline-title">
                                                        <a href="/admintion/leads/${element.student_ids}/" class="text-dark fw-500">
                                                            <h6> ${element.full_name}</h6>
                                                        </a>
                                                        <p class="d-block mb-0">
                                                            ${element.phone_number} 
                                                        </p>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>
                                                <div class="userDatatable-content">
                                                    ${element.source__title} 
                                                </div>
                                            </td>
                                            <td>
                                                <div class="userDatatable-content d-inline-block">
                                                    <span class="bg-opacity-${element.status__color}  color-${element.status__color} rounded-pill userDatatable-content-status active">${element.status__status}</span>
                                                </div>
                                            </td>

                                            <td>
                                                <div class="userDatatable-content">
                                                    ${element.comment}
                                                </div>
                                            </td>
                                            <td>
                                                <div class="d-flex">
                                                    <div class="userDatatable-inline-title">
                                                        <a href="#" class="text-dark fw-500">
                                                            <h6>
                                                                ${element.via_form__title!==null?'<small><span class="bg-opacity-primary  color-primary b-2 userDatatable-content-status active">Havola orqali</span></small>':element.author_name}
                                                            </h6>
                                                        </a>
                                                        <p class="d-block mb-0">
                                                            ${element.formatted_date}
                                                        </p>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>
                                                <ul class="orderDatatable_actions mb-0 d-flex flex-wrap">

                                                    <li>
                                                        <a href="#" class="view drawer-trigger" data-drawer="profile">
                                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg></a>
                                                    </li>
                                                    <li>
                                                        <a href="#" class="edit" data-toggle="modal" data-target="#modal-phone">
                                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-phone"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg></a>
                                                    </li>
                                                    <!-- <li>
                                                                <a href="#" class="view"  data-toggle="modal" data-target="#modal-basic1">
                                                                    <span data-feather="rotate-ccw"></span></a>
                                                            </li> -->
                                                    <!-- <li>
                                                                <a href="#" class="edit">
                                                                    <span data-feather="edit"></span></a>
                                                            </li> -->
                                                    <li>
                                                        <a href="#" class="remove" onclick="changeModal('23')" data-toggle="modal" data-target="#modal-basic">
                                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg></a>
                                                    </li>
                                                </ul>
                                            </td>
                `
                // var columns = {{keys|safe}};
                
                // for(var i=0;i<columns.length;i++){
                //     if(columns[i]=='check'){
                //         var td = document.createElement('td');
                //         var dflex = document.createElement('dev');
                //         dflex.className='d-flex';
                //         dflex.appendChild(createCheckbox(dflex,element.id,idx));
                //         td.appendChild(dflex);
                //         tr.appendChild(td);
                //     }
                //     else if(columns[i] == 'action'){
                //         var td = document.createElement('td');
                //         td.appendChild(createAction(detailUrl.replace("<int:id>",element.id),element.id,element.title));
                //         tr.appendChild(td);  
                //     }
                //     else if(columns[i] == 'status'){
                //         var td = document.createElement('td');
                //         if(element.status){
                //             td.innerHTML = `
                //             <div class="userDatatable-content d-inline-block">
                //                 <span
                //                     class="bg-opacity-success color-success rounded-pill userDatatable-content-status active">Aktiv</span>
                //             </div>
                //             `
                //         }
                //         else{
                //             td.innerHTML = `
                //             <div class="userDatatable-content d-inline-block">
                //                 <span
                //                     class="bg-opacity-warning color-warning rounded-pill userDatatable-content-status active">No Faol</span>
                //             </div>
                //             `
                //         }
                //         tr.appendChild(td); 
                //     }
                //     else {
                        
                //         var td = document.createElement('td');
                //         var dcontent = document.createElement('dev');
                //         // td.style.display='block'
                //         dcontent.className='userDatatable-content'
                //         td.textContent=element[columns[i]];
                //         // td.appendChild(dcontent);
                //         tr.appendChild(td);
                //     }
                // }
                tbody.appendChild(tr);
                var dvTd = document.createElement('div');
                dvTd.className='userDatatable-content';
            });
        }
        function dropdownChanged (e,name){
            var selected = e.target.value;
            if (selected != 0){
                params[name]=e.target.value
            } else {
                params[name]=''
            }
            get_request(generate_path(),dataList)
    
    }
    </script>

    {% endblock %}